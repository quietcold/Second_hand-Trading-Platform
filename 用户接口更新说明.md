# 用户接口更新说明

## 一、新增字段

### 1. 用户个人简介（bio）
在 `User` 实体类中新增 `bio` 字段，用于存储用户的个人简介。

**数据库变更：**
```sql
ALTER TABLE user ADD COLUMN bio VARCHAR(200) COMMENT '个人简介' AFTER image;
```

**影响的类：**
- `User.java` - 实体类
- `UserInfoVO.java` - 用户信息VO
- `UserUpdateDTO.java` - 更新用户信息DTO
- `UserPublicVO.java` - 用户公开信息VO（新增）

---

## 二、新增接口

### 1. 查看其他用户公开信息
**接口**: `GET /user/{userId}`

**路径参数**:
- `userId`: 用户ID

**响应示例**:
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "id": 100,
    "nickname": "张三",
    "gender": "男",
    "image": "http://example.com/avatar.jpg",
    "bio": "这是我的个人简介",
    "createTime": "2026-01-11T10:00:00"
  }
}
```

**说明**:
- 该接口只返回用户的公开信息（昵称、头像、性别、简介等）
- **不包含隐私信息**：手机号、邮箱、账号等

---

### 2. 修改密码
**接口**: `PUT /user/password`

**请求头**:
- `Authorization`: Bearer token（必须登录）

**请求体**:
```json
{
  "oldPassword": "旧密码",
  "newPassword": "新密码"
}
```

**响应示例**:
```json
{
  "code": 1,
  "msg": "success",
  "data": "密码修改成功"
}
```

**错误情况**:
- 旧密码错误: `{ "code": 0, "msg": "旧密码错误" }`
- 用户不存在: `{ "code": 0, "msg": "用户不存在" }`

---

## 三、修改的接口

### 1. 修改个人信息（已支持bio字段）
**接口**: `PUT /user/info`

**请求体**:
```json
{
  "email": "test@example.com",
  "phone": "13800138000",
  "nickname": "新昵称",
  "gender": "男",
  "image": "http://example.com/avatar.jpg",
  "bio": "这是我的个人简介"
}
```

**说明**:
- 新增支持 `bio` 字段的修改
- 空字符串会自动转换为 `null`，避免数据库唯一约束冲突

---

## 四、新增文件

### DTO
- `PasswordUpdateDTO.java` - 修改密码DTO

### VO
- `UserPublicVO.java` - 用户公开信息VO

### SQL
- `user_bio_update.sql` - 用户表结构更新脚本

---

## 五、数据库迁移

在使用新功能前，需要执行以下 SQL 脚本：

```sql
-- 位置：src/main/resources/sql/user_bio_update.sql
ALTER TABLE user ADD COLUMN bio VARCHAR(200) COMMENT '个人简介' AFTER image;
```

---

## 六、使用场景

### 1. 查看商品发布者信息
在商品详情页，点击发布者头像时调用 `GET /user/{userId}` 查看公开信息。

### 2. 查看评论者信息
在评论列表中，点击评论者头像时查看其公开信息。

### 3. 聊天前查看对方信息
在私聊界面，查看对方的公开资料。

### 4. 用户修改密码
在个人设置页面，提供修改密码功能。

### 5. 个人简介展示
- 在个人主页展示自己的简介
- 修改个人信息时可编辑简介
- 其他用户查看公开信息时显示简介

---

## 七、注意事项

1. **隐私保护**：`UserPublicVO` 不返回敏感信息（手机号、邮箱、账号等）
2. **密码安全**：修改密码需要验证旧密码
3. **空值处理**：空字符串自动转为 `null`，避免数据库唯一约束问题
4. **字段长度**：个人简介最多 200 字符

---

## 八、接口汇总

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 用户注册 | POST | `/user/register` | 已有 |
| 用户登录 | POST | `/user/login` | 已有 |
| 查看个人信息 | GET | `/user/info` | 已有 |
| 修改个人信息 | PUT | `/user/info` | **已更新**（支持bio） |
| 查看其他用户公开信息 | GET | `/user/{userId}` | **新增** |
| 修改密码 | PUT | `/user/password` | **新增** |
